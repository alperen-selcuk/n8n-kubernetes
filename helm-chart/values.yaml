namespace: n8n

postgresql:
  enabled: true
  image:
    repository: postgres
    tag: latest
    pullPolicy: IfNotPresent
  replicas: 1
  database: n8n
  username: n8n
  password: PasdN1831c!*n
  storageClass: default
  storage: 10Gi
  port: 5432
  resources: {}

redis:
  enabled: true
  image:
    repository: redis
    tag: 7-alpine
  replicas: 1
  maxMemory: 512mb
  maxMemoryPolicy: allkeys-lru
  appendOnly: "yes"
  storageClass: default
  storage: 2Gi
  port: 6379
  resources:
    requests:
      memory: 256Mi
      cpu: 250m
    limits:
      memory: 512Mi
      cpu: 500m

n8n:
  image:
    repository: docker.n8n.io/n8nio/n8n
    tag: latest
    pullPolicy: IfNotPresent
  
  main:
    enabled: true
    replicas: 1
    storage: 10Gi
    storageClass: default
    resources:
      requests:
        memory: 1Gi
        cpu: 500m
      limits:
        memory: 2Gi
        cpu: 1000m
    livenessProbe:
      httpGet:
        path: /healthz
        port: 5678
      initialDelaySeconds: 60
      periodSeconds: 30
    readinessProbe:
      httpGet:
        path: /healthz
        port: 5678
      initialDelaySeconds: 30
      periodSeconds: 10
  
  worker:
    enabled: true
    replicas: 2
    resources:
      requests:
        memory: 512Mi
        cpu: 250m
      limits:
        memory: 1Gi
        cpu: 500m
    livenessProbe:
      exec:
        command:
          - /bin/sh
          - -c
          - "ps aux | grep '[n]8n worker' || exit 1"
      initialDelaySeconds: 30
      periodSeconds: 30
    readinessProbe:
      exec:
        command:
          - /bin/sh
          - -c
          - "ps aux | grep '[n]8n worker' || exit 1"
      initialDelaySeconds: 10
      periodSeconds: 10
  
  config:
    dbType: postgresdb
    dbHost: postgres
    dbPort: "5432"
    dbDatabase: n8n
    dbUser: n8n
    dbSchema: public
    executionsMode: queue
    queueBullRedisHost: redis
    queueBullRedisPort: "6379"
    queueBullRedisDb: "0"
    host: n8n-test.app.setur.software
    protocol: https
    port: "5678"
    webhookUrl: https://n8n-test.app.setur.software/
    secureCookie: "true"
    blockEnvAccessInNode: "true"
    payloadSizeMax: "16777216"
    executionsDataSaveOnError: all
    executionsDataSaveOnSuccess: all
    executionsDataPrune: "true"
    executionsDataMaxAge: "168"
    timezone: Europe/Istanbul
  
  secret:
    encryptionKey: TjhOc2VjcmV0MTIzKg==
    dbPassword: UGFzZE4xODMxYyEqbg==

service:
  type: ClusterIP
  port: 5678
  targetPort: 5678

ingress:
  enabled: true
  gateway:
    name: traefik-gateway
    namespace: traefik
  hostname: n8n-test.app.setur.software
  http:
    enabled: true
    sectionName: web
    redirectToHttps: true
  https:
    enabled: true

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  scaleDown:
    stabilizationWindowSeconds: 300
    policies:
      - type: Percent
        value: 10
        periodSeconds: 60
  scaleUp:
    stabilizationWindowSeconds: 60
    policies:
      - type: Percent
        value: 50
        periodSeconds: 60
